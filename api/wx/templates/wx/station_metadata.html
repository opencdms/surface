{% extends "wx/station_base.html" %}
{% block station_content %}
{% load static %}

<span id="stationNameChanger" class="srf-display-1 text-uppercase hide"><span id="stationNameChangerText"></span> Metadata</span>

<div id="app" v-cloak>

  <div style="display: flex; justify-content: space-between; margin-bottom: 16px">
    <span v-if="!selectedStation" class="srf-display-1 text-uppercase">Station Metadata</span>
  </div>  
  
  <v-app>

    <v-container style="width: 100%; padding-left: 0 !important; margin-left: 0 !important;">
    <v-layout mt-3 ml-3 mb-3 >
      <v-flex sm3 md3 lg3>
        <v-autocomplete
          :items="stationList"
          :item-text="(item) => `${item.name} ${item.code}`"
          item-value="id"
          v-model="stationId"
          label="Station"
          @change="onChangeStation();changeStationHeader();"
          required
          hint="*Required"
          persistent-hint
          :rules="simpleTextFieldsRules"
          autocomplete="off"
        ></v-autocomplete>
      </v-flex>
    </v-layout>

    <v-layout column mt-3 v-if="selectedStation">
      {% if request.user.is_staff or request.user.is_superuser %}
        <v-layout>
          <v-col cols="6">
                <v-btn
                  class="ml-2"
                  outlined
                  justify-end
                  color="red"
                  @click="toggleEditing"
                >Edit</v-btn> 
                <v-btn
                  v-if="isEditing"
                  class="ml-2"
                  outlined
                  justify-end
                  color="primary"
                  @click="onSaveEdit"
                >SAVE</v-btn>  
                <v-btn
                  v-if="isEditing"
                  class="ml-2"
                  outlined
                  justify-end
                  color="red"
                  @click="cancelEditing"
                >CANCEL</v-btn>   
          </v-col>
        </v-layout>
      {% endif %}

      <v-layout> 
        <v-col cols="6">
          <div style="height: 300px; width: 100%;">
            <l-map
              ref="myMap"
              :zoom="zoom"
              :center="center"
              :options="options"
              style="z-index: 0;"
            >
              <l-marker :lat-lng="markerPosition" draggable @dragend="onMarkerDragEnd($event)">
                <l-icon :icon-size="iconSizeTest" :icon-anchor="iconAnchor">
                  <img src="{% static 'images/placeholder.png' %}" />
                </l-icon>
              </l-marker>
      
              <l-tile-layer :url="url" :attribution="attribution"></l-tile-layer>
              <l-control-zoom :position="zoomPosition"></l-control-zoom>
            </l-map>
          </div>
        </v-col>

        <v-col cols="6">
          <template v-if="stationImagesList.length">
            <v-carousel
              :key="carouselId"
              cycle
              height="auto"
              show-arrows-on-hover
            >
              <v-carousel-item
                eager
                v-for="(image, i) in stationImagesList"
                :key="i"
              >
                <v-img :src="image.path" min-height="300" max-height="300" contains></v-img>
              </v-carousel-item>
            </v-carousel>
          </template>
          <div style="margin: 0 auto;" v-if="!stationImagesList.length">No image available!</div>
        </v-col>
      </v-layout>

      <template>
        <v-tabs class="mt-3" @change="cancelEditing">
          <v-tab :key="1">
            Station Information
          </v-tab>
          <v-tab :key="4">
            Local Environment
          </v-tab>
          <v-tab :key="5">
            Instrumentation and Maintenance
          </v-tab>
          <v-tab :key="6">
            Observing Practices
          </v-tab>
          <v-tab :key="7">
            Data Processing
          </v-tab>
          <v-tab :key="8">
            Historical Events
          </v-tab>
          <v-tab :key="9">
            Other Metadata
          </v-tab>

          <!--Station information-->
          <v-tab-item :key="1">
          <form id="stationInformation" @submit="checkStationInformation">
            <div class="row w-100 mt-3">
            
              <div class="col s4" v-tooltip="3-03">

                  <v-text-field
                    type="text"
                    v-model="selectedStation.name"
                    label="Station/Platform Name"
                    required
                    hint="*Required"
                    persistent-hint
                    :rules="simpleTextFieldsRules"
                    :disabled="!isEditing"
                    :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                  >
                  <v-tooltip slot="append" right>
                    <template v-slot:activator="{ on }">
                      <v-icon 
                      v-on="on" 
                      color="primary" 
                      dark
                      >
                      info
                      </v-icon>
                    </template>
                    <span>WIGOS category 3-03</span>
                  </v-tooltip>
                  </v-text-field>

              </div>
            

              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.alias_name"
                  label="Alias Name"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                ></v-text-field>
              </div>

            </div>
            
            <div class="row w-100 mt-3">
              
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.code"
                  label="Local Station ID"
                  disabled
                ></v-text-field>
              </div>

              <div class="col s4">
                
                <v-text-field
                  type="text"
                  v-model="selectedStation.wigos"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleTextFieldsRules"
                  label="Station/Platform unique indetifier"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                >
                   <v-tooltip slot="append" right>
                      <template v-slot:activator="{ on }">
                        <v-icon 
                        v-on="on" 
                        color="primary" 
                        dark
                        >
                        info
                        </v-icon>
                      </template>
                      <span>WIGOS category 3-06 (WIGOS ID)</span>
                    </v-tooltip>
                </v-text-field>
                  
              </div>

            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-autocomplete
                :items="wmoProgramList"
                item-text="name"
                item-value="id"
                v-model="selectedStation.wmo"
                label="WMO Program"
                required
                hint="*Required"
                persistent-hint
                :rules="simpleTextFieldsRules"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                autocomplete="off"
              >
              <v-tooltip slot="append" right>
                <template v-slot:activator="{ on }">
                  <v-icon 
                  v-on="on" 
                  color="primary" 
                  dark
                  >
                  info
                  </v-icon>
                </template>
                <span>WIGOS category 2-02</span>
              </v-tooltip>
              </v-autocomplete>
              </div>
              <div class="col s4">
                <v-menu
                  :close-on-content-click="false"
                  v-model="begin_date_menu"
                  transition="scale-transition"
                  offset-y
                >
                  <template v-slot:activator="{ on }">
                    <v-text-field
                      v-model="selectedStation.begin_date"
                      label="Begin Date"
                      v-on="on"
                      required
                      prepend-icon="event"
                      hint="*Required"
                      :rules="dateSimpleRules"
                      {% if request.user.is_staff or request.user.is_superuser %}
                      clearable
                      {% endif %}
                      persistent-hint
                      :disabled="!isEditing"
                      :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                      false
                      {% else %}
                      true
                      {% endif %}"
                    ></v-text-field>
                  </template>
                  {% if request.user.is_staff or request.user.is_superuser %}
                  <v-date-picker
                    v-model="selectedStation.begin_date"
                    @input="begin_date_menu = false"
                    hint="*Required"
                    required
                    no-title
                    persistent-hint
                  ></v-date-picker>
                  {% endif %}
                </v-menu>
              </div>
            </div>

            <div class="row w-100 mt-3">
              
              <div class="col s4">
                <v-menu
                  :close-on-content-click="false"
                  v-model="end_date_menu"
                  transition="scale-transition"
                  offset-y
                >
                  <template v-slot:activator="{ on }">
                    <v-text-field
                      v-model="selectedStation.end_date"
                      label="End date"
                      v-on="on"
                      prepend-icon="event"
                      :disabled="!isEditing"
                      {% if request.user.is_staff or request.user.is_superuser %}
                      clearable
                      {% endif %}
                      :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                      false
                      {% else %}
                      true
                      {% endif %}"
                    ></v-text-field>
                  </template>
                  {% if request.user.is_staff or request.user.is_super %}
                  <v-date-picker
                    v-model="selectedStation.end_date"
                    no-title
                    @input="end_date_menu = false"
                  ></v-date-picker>
                  {% endif %}
                </v-menu>
              </div>

              <div class="col s4">
                <v-menu
                  :close-on-content-click="false"
                  v-model="relocation_date_menu"
                  transition="scale-transition"
                  offset-y
                >
                  <template v-slot:activator="{ on, attrs}">
                    <v-text-field
                      v-model="selectedStation.relocation_date"
                      label="Date of relocation"
                      v-on="on"
                      v-bind="attrs"
                      prepend-icon="event"
                      :disabled="!isEditing"
                      {% if request.user.is_staff or request.user.is_superuser %}
                      clearable
                      {% endif %}
                      :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                      false
                      {% else %}
                      true
                      {% endif %}"
                    ></v-text-field>
                  </template>
                  {% if request.user.is_staff or request.user.is_super %}
                  <v-date-picker
                    :active-picker.sync="activePicker"
                    v-model="selectedStation.relocation_date"
                    no-title
                    @input="relocation_date_menu = false"
                  ></v-date-picker>
                  {% endif %}
                </v-menu>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <div class="srf-field">
                  <span class="srf-field-header">Station operation Status (Active or Inactive)</span>
                  <v-switch
                    v-model="selectedStation.is_active"
                    :disabled="!isEditing"
                    :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                  >
                  <v-tooltip slot="append" right>
                    <template v-slot:activator="{ on }">
                      <v-icon 
                      v-on="on" 
                      color="primary" 
                      dark
                      >
                      info
                      </v-icon>
                    </template>
                    <span>WIGOS category 3-09</span>
                  </v-tooltip>
                </div>
              </div>
              <div class="col s4">
                <div class="srf-field">
                  <span class="srf-field-header">Conventional or Automatic</span>
                  <v-switch
                    v-model="selectedStation.is_automatic"
                    :disabled="!isEditing"
                    :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                    false
                    {% else %}
                    true
                    {% endif %}"
                  >
                </div>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Network (Local)"
                v-model="selectedStation.network"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
              <div class="col s4">
                <v-autocomplete
                  :items="wmoStationTypeList"
                  item-text="name"
                  item-value="id"
                  v-model="selectedStation.wmo_station_type"
                  label="Station/Platform Type (WMO)"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleTextFieldsRules"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                  autocomplete="off"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-04</span>
                </v-tooltip>
                </v-autocomplete>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-autocomplete
                  :items="stationProfileList"
                  item-text="name"
                  item-value="id"
                  v-model="selectedStation.profile"
                  label="Type of Station (Local Profile)"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleTextFieldsRules"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                  autocomplete="off"
                ></v-autocomplete>
              </div>
              <div class="col s4">
                <v-autocomplete
                  :items="stationCommunicationList"
                  item-text="name"
                  item-value="id"
                  v-model="selectedStation.communication_type"
                  label="Communication"
                  required
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                  autocomplete="off"
                ></v-autocomplete>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.latitude"
                  label="Latitude"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleFloatFieldsRules"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-07</span>
                </v-tooltip>
                </v-text-field>
              </div>
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.longitude"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleFloatFieldsRules"
                  label="Longitude"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-07</span>
                </v-tooltip>
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.elevation"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleFloatFieldsRules"
                  label="Elevation"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-07</span>
                </v-tooltip>
                </v-text-field>
              </div>
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.country"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleTextFieldsRules"
                  label="Country"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-02</span>
                </v-tooltip>
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.region"
                  label="Local Administrative Region(District)"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                ></v-text-field>
              </div>
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.watershed"
                  label="Basin"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                ></v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-autocomplete
                  :items="wmoRegionList"
                  item-text="name"
                  item-value="id"
                  v-model="selectedStation.wmo_region"
                  label="WMO Region"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="simpleTextFieldsRules"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                  autocomplete="on"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-01</span>
                </v-tooltip>
                </v-autocomplete>
              </div>
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.utc_offset_minutes"
                  label="Time Zone (UTC offset in minutes)"
                  required
                  hint="*Required"
                  persistent-hint
                  :rules="timezoneRules"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                ></v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.wmo_station_plataform"
                  label="Station/Platform model (WMO)"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-05</span>
                </v-tooltip>
                </v-text-field>
              </div>
              <div class="col s4">
                <v-text-field
                  type="text"
                  v-model="selectedStation.data_type"
                  label="Data Communication Method"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
                <v-tooltip slot="append" right>
                  <template v-slot:activator="{ on }">
                    <v-icon 
                    v-on="on" 
                    color="primary" 
                    dark
                    >
                    info
                    </v-icon>
                  </template>
                  <span>WIGOS category 3-08</span>
                </v-tooltip>

                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                  type="text"
                  v-model="selectedStation.observer"
                  label="Local Observer Name"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
              </div>

              <div class="col s4">
                <v-text-field 
                  type="text"
                  v-model="selectedStation.organization"
                  label="Responsible Organization (Local)"
                  :disabled="!isEditing"
                  :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                  false
                  {% else %}
                  true
                  {% endif %}"
                >
              </div>
            </div>
            
            {% if request.user.is_staff or request.user.is_superuser %}
            <v-btn
              v-if="isEditing"
              class="ml-2"
              outlined
              justify-end
              color="primary"
              @click="onSaveEdit"
            >SAVE</v-btn>  
            <v-btn
              v-if="isEditing"
              class="ml-2"
              outlined
              justify-end
              color="red"
              @click="cancelEditing"
            >CANCEL</v-btn>  
            {% endif %}
          </form>  
        </v-tab-item >

          <!--Local Enviroment-->
          <v-tab-item :key="2" >

          <form id="localEnviroment" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text"
                label="Local land use/land cover"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Instrument exposure"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Soil type"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>
            
            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Site conditions"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Photos"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Site plans"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>
              


            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Skyline Diagrams"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="WIGOS Metadata"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            
            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>

          <!--Instrumentation and Maintenance-->
          <v-tab-item :key="3" >

          <form id="instrumentationAndMaintenance" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Type of instruments"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Instrument comparisons"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Start/end dates of instruments"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Condition of instruments"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Instrument sheltering and mounting"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Type of recording"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Calibration results"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Special maintenance faults"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Modifications"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>
            
            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field
                type="text"
                label="Barometer height"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="WIGOS"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>


            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>           

          <!--Observing Practices-->
          <v-tab-item :key="4" >

          <form id="observingPratices" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Observer Information"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Observer level of training"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="List of observed elements"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Observing times"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text"
                label="Units used"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Observation instructions"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Routine maintenance operations"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Disposable item replacement"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Corrections made by observer"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Observed Variable"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Purpose of observation"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>         

          <!--Data Processing-->
          <v-tab-item :key="5" >

          <form id="dataProcessing" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Units"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Special codes"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Calculations"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Algorithms"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text"
                label="QC applied?"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Homogenization applied?"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Data recovery efforts?"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Other data detail on data recovery"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Treatment of redundant data"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="WIGOS sampling"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="WIGOS data processing and reporting"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>

            </div>

            <div class="row w-100 mt-3">

              <div class="col s4">
                <v-text-field 
                type="text" 
                label="WIGOS data quality"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>


            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>

          <!--Historical Events-->
          <v-tab-item :key="6">
          <form id="historicalEvents" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field 
                type="text" 
                label="Historic"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>

          <!--Other metadata-->
          <v-tab-item :key="7" >
          <form id="otherMetadata" @submit="">

            <div class="row w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Communication"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
              <div class="col s4">
                <v-text-field
                type="text"
                label="Ownership and data policy"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            <div class="col w-100 mt-3">
              <div class="col s4">
                <v-text-field
                type="text"
                label="Contact"
                :disabled="!isEditing"
                :readonly="{% if request.user.is_staff or request.user.is_superuser %}
                false
                {% else %}
                true
                {% endif %}"
                >
                </v-text-field>
              </div>
            </div>

            {% if request.user.is_staff or request.user.is_superuser %}
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="primary"
                @click="onSaveEdit"
              >SAVE</v-btn>  
              <v-btn
                v-if="isEditing"
                class="ml-2"
                outlined
                justify-end
                color="red"
                @click="cancelEditing"
              >CANCEL</v-btn>  
            {% endif %}
          </form>
          </v-tab-item>

        </v-tabs>

          </form>
          </v-tab-item> 
     
        
      </v-tabs>
    </template>
    </v-layout>
    </v-container>
  </v-app>
</div>
{% endblock %}

{% block localjavascript %}
  <script>

    var {
      LMap,
      LTileLayer,
      LControlZoom,
      LMarker,
      LTooltip,
      LControlLayers,
      LGeoJson,
      LImageOverlay,
      LIcon
    } = Vue2Leaflet;

    Vue.use(window.vuelidate.default);
    const { required, minLength } = window.validators;

    new Vue({
      el: "#app",
      vuetify: new Vuetify(),
      delimiters: ["[[", "]]"],
      components: {
        LMap,
        LTileLayer,
        LControlZoom,
        LMarker,
        LTooltip,
        LControlLayers,
        LGeoJson,
        LImageOverlay,
        LIcon
      },
      data: {
        ghty: "looolz",
        iconSizeTest: [32, 32],
        zoom: "{{ MAP_ZOOM|safe }}",
        center: L.latLng("{{ MAP_LATITUDE|safe }}", "{{ MAP_LONGITUDE|safe }}"),
        url: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        attribution:
          '&copy, <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        options: { zoomControl: false },
        zoomPosition: "bottomleft",
        timezone: "{{ TIMEZONE_NAME|escapejs }}",
        stationId: "{{ station_id|safe }}",
        iconAnchor: [16, 32],
        selectedStation: {},
        testing: {},
        backupStationObject: null,
        stationList: [],
        stationImagesList: [],
        carouselId: 0,
        begin_date_menu: false,
        end_date_menu: false,
        relocation_date_menu: false,
        imageToUpload: {},
        documentToUpload: {},
        stationDocumentsList: [],
        errors: [],
        loading: false,
        integerRegularExpression: /^[-+]?[0-9]+$/,
        activePicker: null,
        simpleTextFieldsRules: [
          v => (v !== undefined && v !== "") || "This field is required"
        ],
        dateSimpleRules: [
        v => (v !== null && v !== "") || "This field is required"
        ],
        simpleFloatFieldsRules: [
          v => (v !== undefined && v !== "") || "This field is required",
          v => (/^[-+]?[0-9]+([.][0-9]+)?$/.test(v)) || "Invalid input"
        ],
        timezoneRules: [
          v => (v !== undefined && v !== "") || "This field is required",
          v => (/^[-+]?[0-9]+$/.test(v)) || "Invalid input",
          v => (v >= -720 && v <= 720) || "Value must be between -720 and 720"
        ],
        documents_headers: [
          { text: "Name", value: "name", align: "left"},
          { text: 'Actions', value: 'action', align: "center", sortable: false },
        ],
        isEditing: false,
        wmoStationTypeList: [
          "{% for wmo_station_type in wmo_station_type_list %}",
          {id: "{{ wmo_station_type.id }}", name: "{{ wmo_station_type.name }}" },
          "{% endfor %}"
        ],
        wmoRegionList: [
          "{% for wmo_region in wmo_region_list %}",
          {id: "{{ wmo_region.id }}", name: "{{ wmo_region.name }}" },
          "{% endfor %}"
        ],
        wmoProgramList: [
          "{% for wmo_program in wmo_program_list %}",
          {id: "{{ wmo_program.id }}", name: "{{ wmo_program.name }}" },
          "{% endfor %}"
        ],
        stationProfileList: [
          "{% for station_profile in station_profile_list %}",
          {id: "{{ station_profile.id }}", name: "{{ station_profile.name }}" },
          "{% endfor %}"
        ],
        stationCommunicationList: [
          "{% for station_communication in station_communication_list %}",
          {id: "{{ station_communication.id }}", name: "{{ station_communication.name }}" },
          "{% endfor %}"
        ],
      },
      computed: {
        baseURL() {
          return "/";
        },
        
        markerPosition(){
          if(this.selectedStation){
            this.center = L.latLng(this.selectedStation.latitude, this.selectedStation.longitude)
            return {lat: this.selectedStation.latitude, lng: this.selectedStation.longitude}
          }
          return {}
        },

      
      },
      methods: {
        getStations(){
          this.getAll("api/stations_metadata/").then(data => {
            this.stationList = data;
            this.onChangeStation();
          });
        },

        getStationImages(station_id){
          this.getAll(`api/station_images?station_id=${station_id}`).then(data => {
            this.stationImagesList = data.map(stationImage => {
              stationImage.show = false;
              return stationImage;
            });
            this.carouselId++;
          });
        },

        getStationDocuments(station_id){
          this.getAll(`api/station_files?station_id=${station_id}`).then(data => {
            this.stationDocumentsList = data;
          });
        },

        getAll(path, url, oldData = []) {
          return fetch(`${this.baseURL}${path}`)
            .then(res => {
              if (!res.body) {
                return { next: null, results: [] };
              }

              return res.json();
            })
            .then(async data => {
              const values = [...oldData, ...data.results];
              if (!!data.next) {
                return await getAll(
                  context,
                  path,
                  `${this.baseURL}/${path}/${data.next.substr(
                    data.next.indexOf(`/${path}`)
                  )}`,
                  values
                );
              }
              return values;
            });
        },
        removeImage(stationImage){
          this.loading = true;
          axios.delete(`/api/station_images/${stationImage.id}/`).then(data => {
            this.stationImagesList = this.stationImagesList.filter(obj => obj.id != stationImage.id);
            this.loading = false;
          });
        },
        uploadImage(){
          this.loading = true;
          let requests = this.imageToUpload.path.map(file => {
            let formData = new FormData();
            formData.append("path", file, file.name);
            formData.append("name", file.name);
            formData.append("station", this.selectedStation.id);
            return axios.post("/api/station_images/", formData);
          })

          axios.all(requests).then(responseArray => {
            responseArray.forEach(res => {
              res.data.show = false;
              this.stationImagesList.unshift(res.data);
            });
            this.imageToUpload = {};
            this.loading = false;
          });
        },
        
        uploadDocument(){
          this.loading = true;
          let requests = this.documentToUpload.path.map(file => {
            let formData = new FormData();
            formData.append("file", file, file.name);
            formData.append("name", file.name);
            formData.append("station", this.selectedStation.id);
            return axios.post("/api/station_files/", formData);
          });

          axios.all(requests).then(responseArray => {
            responseArray.forEach(res => this.stationDocumentsList.unshift(res.data));
            this.documentToUpload = {};
            this.loading = false;
          });
        },
        showStationImage(stationImage){
          stationImage.show = true;
        },
        hideStationImage(stationImage){
          stationImage.show = false;
        },
        onMarkerDragEnd(event){
          let marker = event.target;
          let position = marker.getLatLng();
          this.selectedStation.latitude = position.lat;
          this.selectedStation.longitude = position.lng;
        },
        checkStationInformation(e){
          this.errors = [];

          if(!this.selectedStation.name) this.errors.push('Name required.')
          if(!this.selectedStation.wigos) this.errors.push('WIGOS Station ID required.')
          if(!this.selectedStation.wmo_program) this.errors.push('WMO Program required.')
          if(!this.selectedStation.begin_date) this.errors.push('Established Date required.')
          if(!this.selectedStation.profile) this.errors.push('Profile required.')
          if(!this.selectedStation.wmo_station_type) this.errors.push('WMO Station Type required.')
          if(!this.selectedStation.latitude) this.errors.push('Latitude required.')
          if(!this.selectedStation.longitude) this.errors.push('Longitude required.')
          if(!this.selectedStation.country) this.errors.push('Country required.')
          if(!this.selectedStation.wmo_region) this.errors.push('WMO Region required.')
          if(!this.selectedStation.utc_offset_minutes) this.errors.push('Country time Zone required.')

          e.preventDefault();

          return !!this.errors;
        },

        downloadDocument(item) {
          window.open(item.file)
        },

        deleteItem(stationFile){
          this.loading = true;
          axios.delete(`/api/station_files/${stationFile.id}/`).then(data => {
            this.stationDocumentsList = this.stationDocumentsList.filter(obj => obj.id != stationFile.id);
            this.loading = false;
          });
        },

        cancelEditing(){
          this.isEditing = false;
          this.selectedStation = {... this.backupStationObject};
        },

        onSaveEdit() {
          
          this.loading = true;
          const payload = { ...this.selectedStation };

          if(!!payload.relocation_date) {
            payload.relocation_date = moment.utc(payload.relocation_date).format('YYYY-MM-DD[T]HH:mm:ss')
          } else {
            payload.relocation_date = null
          } 

          if(!!payload.end_date)
          {  
            payload.end_date = moment.utc(payload.end_date).format('YYYY-MM-DD[T]HH:mm:ss')
          } else { 
            payload.end_date = null
          }

          if (!!payload.begin_date) {
            payload.begin_date = moment.utc(payload.begin_date).format('YYYY-MM-DD[T]HH:mm:ss');
          }
          
          axios.put(`/api/stations_metadata/${this.selectedStation.id}/`, payload).then(data => {
          console.log(data)
          this.loading = false;
          });
        },

        finishEditing(){
          this.isEditing = false;
          this.backupStationObject = {... this.selectedStation};
        },

        toggleEditing(){
          if (this.isEditing) {

            this.isEditing = false;
            
          } 
          else {
            
            this.isEditing = true;

          }

          this.backupStationObject = {... this.selectedStation};
        },

        onChangeStation() {

          if(this.stationId != null){
              this.selectedStation = this.stationList.find(station => station.id === this.stationId);
              this.selectedStation.begin_date = moment.utc(this.selectedStation.begin_date).format('YYYY-MM-DD');
              if(!!this.selectedStation.end_date) { 
                this.selectedStation.end_date = moment.utc(this.selectedStation.end_date).format('YYYY-MM-DD')
              }
              if(!!this.selectedStation.relocation_date){
                this.selectedStation.relocation_date = moment.utc(this.selectedStation.relocation_date).format('YYYY-MM-DD')
              }

              this.backupStationObject = {... this.selectedStation};
              this.getStationImages(this.stationId);
              this.getStationDocuments(this.stationId);
            }
        },

        changeStationHeader() {
          document.getElementById("stationNameChanger").classList.remove("hide");
          document.getElementById("stationNameChangerText").innerHTML = this.selectedStation.name;
        },

        formatDate(datetime){
          if(datetime != null)
            return moment.utc(datetime).clone().format('YYYY-MM-DD');
          return datetime;
        }
      },
      mounted(){
        axios.defaults.xsrfHeaderName = "X-CSRFToken"
        axios.defaults.xsrfCookieName = 'csrftoken'
        this.getStations();
      }
    })
    
  </script>

  <style>
    .image-overlay {
      background-color: white;
      opacity: .85;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    [v-cloak] { 
      display: none;
    }
  </style>
{% endblock %}